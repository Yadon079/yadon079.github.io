---
layout: post
date: 2020-09-10 20:39:00
title: "크리티컬 섹션(Critical Section)"
description: "프로그래밍 / 소켓 프로그래밍"
subject: Interest
category: [ cs ]
tags: [ cs, programming, socket programming ]
comments: true
---

# 임계 영역

임계 영역이란, 멀티쓰레드 환경에서 다수의 쓰레드들이 동시에 어떤 코드를 실행할 때, 각 쓰레드들이 서로 다른 결과를 내놓는, 동시 접근 문제가 발생할 수 있는 코드의 한 부분(영역)이다.

한 애플리케이션에서 다수의 쓰레드를 실행하는 일이 스스로 문제를 유발하는 것은 아니다. 문제는 다수의 쓰레드가 같은 자원에 접근할 때 발생한다. 여기서 같은 자원이란, 같은 메모리(변수, 배열, 혹은 객체), 시스템(데이터베이스, 웹서비스 등등), 또는 파일을 말한다.

하나 이상의 쓰레드가 자원에 접근하여 <b>쓰기</b> 작업을 수행할 때 문제가 발생한다. 다수의 쓰레드가 같은 자원에 접근하더라도, 자원에 변경(수정)을 시도하지 않는 한 문제는 발생하지 않는다.

다음 자바 코드는 임계 영역 예제이다. 이 코드는 멀티쓰레드로 동시에 실행될 때 문제가 발생할 수 있다.

```java
public class Counter {
  protected long count = 0;

  public void add(long value) {
    this.count = this.count + value;
  }
}
```

두 쓰레드 A, B가 있고 이 쓰레드들이 Counter 클래스의 add() 메소드를 호출하는 상황일 떄, 명령 시스템이 두 쓰레드 중 어느 쪽을 언제 실행할지 알 수 있는 방법은 없다. 위 코드에서 add() 메소드는 atomic instruction으로 실행되지 않는다.

자바에서는 이러한 임계영역의 처리를 위해 <b>Synchronized</b> 키워드가 제공된다.

임계 영역에 접근하는 기능을 가지고 있는 메소드 앞에 Synchronized 키워드를 붙이면 자동으로 임계영역 설정이 되어 한번에 하나의 쓰레드에게만 접근을 허용할 수 있다.

메소드 전체를 임계영역으로 설정할 수도 있고, 특정한 영역을 임계영역으로 설정(객체의 참조변수)할 수도 있다.
